---
const { lang, t } = Astro.props;
const switchUrl = lang === "es" ? "/en" : "/";
---
<header class="site-header">
  <nav class="nav">
    <!-- LOGO -->
    <strong class="logo">Facundo Ruiz</strong>

    <!-- DESKTOP NAV LINKS -->
    <ul class="nav-links">
      <li><a href="#projects">{t.nav.projects}</a></li>
      <li><a href="#skills">{t.nav.skills}</a></li>
    </ul>

    <!-- ACTION BUTTONS -->
    <div class="nav-actions">
      <!-- LANGUAGE SWITCH -->
      <a href={switchUrl} class="nav-lang" transition:name="lang">
        {lang === "es" ? "EN" : "ES"}
      </a>

      <!-- THEME TOGGLE -->
      <button
        id="theme-toggle"
        class="theme-toggle"
        aria-label="Toggle theme"
      >
        <img
          id="theme-icon"
          src="/icons/moon.svg"
          alt=""
          width="18"
          height="18"
        />
      </button>

      <!-- MOBILE HAMBURGER -->
      <button
        class="nav-toggle"
        aria-label="Toggle menu"
        aria-expanded="false"
      >
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>

  <!-- MOBILE MENU -->
  <ul class="nav-mobile">
    <li><a href="#projects">{t.nav.projects}</a></li>
    <li><a href="#skills">{t.nav.skills}</a></li>
  </ul>
</header>

<script>
  /* ===============================
     MOBILE MENU TOGGLE
  =============================== */
  function initHeader() {
    const toggle = document.querySelector(".nav-toggle");
    const menu = document.querySelector(".nav-mobile");
    const links = menu?.querySelectorAll("a");

    if (!toggle || !menu) return;

    toggle.onclick = () => {
      const open = menu.classList.toggle("open");
      toggle.setAttribute("aria-expanded", open);
    };

    // Close menu when a link is clicked (mobile)
    links?.forEach((link) => {
      link.onclick = () => {
        menu.classList.remove("open");
        toggle.setAttribute("aria-expanded", "false");
      };
    });
  }

  /* ===============================
     THEME TOGGLE SYNC
  =============================== */
  function initThemeToggle() {
    const btn = document.getElementById("theme-toggle");
    const icon = document.getElementById("theme-icon");
    if (!btn || !icon || !window.toggleTheme) return;

    function syncIcon() {
      const isDark = document.documentElement.dataset.theme === "dark";
      icon.src = isDark ? "/icons/sun.svg" : "/icons/moon.svg";
      icon.alt = isDark ? "Sun icon" : "Moon icon";
    }

    syncIcon();
    btn.onclick = () => window.toggleTheme();
    document.addEventListener("theme-change", syncIcon);
  }

  /* ===============================
     HEADER BORDER ON SCROLL
     - No border when page is at top
     - Border appears after scrolling
  =============================== */
  function initHeaderBorder() {
    const header = document.querySelector(".site-header");
    if (!header) return;

    function onScroll() {
      if (window.scrollY === 0) {
        header.classList.add("at-top");
      } else {
        header.classList.remove("at-top");
      }
    }

    // Initial state
    onScroll();

    // Listen for scroll changes
    window.addEventListener("scroll", onScroll);
  }

  // Initial load
  initHeader();
  initThemeToggle();
  initHeaderBorder();

  // Re-init on Astro page transitions
  document.addEventListener("astro:page-load", () => {
    initHeader();
    initThemeToggle();
    initHeaderBorder();
  });
</script>

