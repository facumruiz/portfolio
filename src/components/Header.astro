---
const { lang, t } = Astro.props;
const switchUrl = lang === "es" ? "/en" : "/";
---
<header class="site-header">
  <nav class="nav">
    <!-- LOGO -->
    <strong class="logo">Facundo Ruiz</strong>

    <!-- DESKTOP NAV LINKS -->
    <ul class="nav-links">
      <li><a href="#projects">{t.nav.projects}</a></li>
      <li><a href="#skills">{t.nav.skills}</a></li>
    </ul>

    <!-- ACTION BUTTONS -->
    <div class="nav-actions">
      <!-- LANGUAGE SWITCH -->
      <a href={switchUrl} class="nav-lang" transition:name="lang">
        {lang === "es" ? "EN" : "ES"}
      </a>

      <!-- THEME TOGGLE -->
      <button
        id="theme-toggle"
        class="theme-toggle"
        aria-label="Toggle theme"
      >
        <img
          id="theme-icon"
          src="/icons/moon.svg"
          alt=""
          width="18"
          height="18"
        />
      </button>

      <!-- MOBILE HAMBURGER -->
      <button
        class="nav-toggle"
        aria-label="Toggle menu"
        aria-expanded="false"
      >
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>

  <!-- MOBILE MENU -->
  <ul class="nav-mobile">
    <li><a href="#projects">{t.nav.projects}</a></li>
    <li><a href="#skills">{t.nav.skills}</a></li>

    <!-- FOOTER -->
    <li class="nav-mobile-footer">
      <div class="nav-socials">
        <a
          href="https://github.com/facumruiz"
          target="_blank"
          aria-label="GitHub"
        >
          <img src="/icons/github.svg" alt="" />
        </a>

        <a
          href="https://linkedin.com/in/facumruiz"
          target="_blank"
          aria-label="LinkedIn"
        >
          <img src="/icons/linkedin.svg" alt="" />
        </a>
      </div>
    </li>
  </ul>
</header>

<script>
  const NAV_HEIGHT = 72;
  const SCROLL_OFFSET = 8;
  const SCROLL_DELAY = 320;

  function initHeader() {
    const toggle = document.querySelector(".nav-toggle");
    const menu = document.querySelector(".nav-mobile");
    const links = menu?.querySelectorAll("a");

    if (!toggle || !menu) return;

    function isOpen() {
      return toggle.getAttribute("aria-expanded") === "true";
    }

    function openMenu() {
      menu.classList.add("open");
      toggle.setAttribute("aria-expanded", "true");
    }

    function closeMenu() {
      menu.classList.remove("open");
      toggle.setAttribute("aria-expanded", "false");
    }

    function isAtTop() {
      return window.scrollY <= 0;
    }

    toggle.onclick = () => {
      if (isOpen()) {
        closeMenu();
        return;
      }

      // Never open menu while at top
      if (isAtTop()) {
        window.scrollTo({
          top: NAV_HEIGHT + SCROLL_OFFSET,
          behavior: "smooth"
        });

        setTimeout(openMenu, SCROLL_DELAY);
      } else {
        openMenu();
      }
    };

    links?.forEach((link) => {
      link.onclick = () => closeMenu();
    });
  }

  function initThemeToggle() {
    const btn = document.getElementById("theme-toggle");
    const icon = document.getElementById("theme-icon");
    if (!btn || !icon || !window.toggleTheme) return;

    function syncIcon() {
      const isDark = document.documentElement.dataset.theme === "dark";
      icon.src = isDark ? "/icons/sun.svg" : "/icons/moon.svg";
    }

    syncIcon();
    btn.onclick = () => window.toggleTheme();
    document.addEventListener("theme-change", syncIcon);
  }

  function initHeaderBorder() {
    const header = document.querySelector(".site-header");
    if (!header) return;

    function onScroll() {
      header.classList.toggle("at-top", window.scrollY === 0);
    }

    onScroll();
    window.addEventListener("scroll", onScroll);
  }

  function initAll() {
    initHeader();
    initThemeToggle();
    initHeaderBorder();
  }

  initAll();
  document.addEventListener("astro:page-load", initAll);
</script>

