---
const { lang, t } = Astro.props;
const switchUrl = lang === "es" ? "/en" : "/";
---
<header class="site-header">
  <nav class="nav">
    <!-- LOGO -->
    <strong class="logo">Facundo Ruiz</strong>

    <!-- LINKS DESKTOP -->
    <ul class="nav-links">
      <li><a href="#projects">{t.nav.projects}</a></li>
      <li><a href="#skills">{t.nav.skills}</a></li>
    </ul>

    <!-- ACTIONS -->
    <div class="nav-actions">
      <!-- LANG -->
      <a href={switchUrl} class="nav-lang" transition:name="lang">
        {lang === "es" ? "EN" : "ES"}
      </a>

      <!-- THEME -->
      <button
        id="theme-toggle"
        class="theme-toggle"
        aria-label="Toggle theme"
      >
        <img
          id="theme-icon"
          src="/icons/moon.svg"
          alt=""
          width="18"
          height="18"
        />
      </button>

      <!-- HAMBURGER -->
      <button
        class="nav-toggle"
        aria-label="Toggle menu"
        aria-expanded="false"
      >
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>

  <!-- MOBILE MENU -->
  <ul class="nav-mobile">
    <li><a href="#projects">{t.nav.projects}</a></li>
    <li><a href="#skills">{t.nav.skills}</a></li>
  </ul>
</header>

<script>
  function initHeader() {
    const toggle = document.querySelector(".nav-toggle");
    const menu = document.querySelector(".nav-mobile");
    const links = menu?.querySelectorAll("a");

    if (!toggle || !menu) return;

    toggle.onclick = () => {
      const open = menu.classList.toggle("open");
      toggle.setAttribute("aria-expanded", open);
    };

    // close menu on link click (mobile)
    links?.forEach((link) => {
      link.onclick = () => {
        menu.classList.remove("open");
        toggle.setAttribute("aria-expanded", "false");
      };
    });
  }

  function initThemeToggle() {
    const btn = document.getElementById("theme-toggle");
    const icon = document.getElementById("theme-icon");
    if (!btn || !icon || !window.toggleTheme) return;

    function syncIcon() {
      const isDark = document.documentElement.dataset.theme === "dark";
      icon.src = isDark ? "/icons/sun.svg" : "/icons/moon.svg";
      icon.alt = isDark ? "/icons/moon.svg" : "/icons/sun.svg";
    }

    syncIcon();
    btn.onclick = () => window.toggleTheme();
    document.addEventListener("theme-change", syncIcon);
  }

  initHeader();
  initThemeToggle();

  document.addEventListener("astro:page-load", () => {
    initHeader();
    initThemeToggle();
  });
</script>

